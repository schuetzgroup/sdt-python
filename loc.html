

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Fluorescent feature localization &mdash; sdt-python 17.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="GUIs for the Jupyter notebook" href="nbui.html" />
    <link rel="prev" title="Flat-field correction" href="flatfield.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> sdt-python
          

          
          </a>

          
            
            
              <div class="version">
                17.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="roi.html">Regions of interest (ROIs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="multicolor.html">Multi-color data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="motion.html">Diffusion analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="brightness.html">Brightness analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Data input/output</a></li>
<li class="toctree-l1"><a class="reference internal" href="changepoint.html">Changepoint detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial.html">Analyze spatial aspects of data</a></li>
<li class="toctree-l1"><a class="reference internal" href="fret.html">Single molecule FRET analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Image filtering and processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="flatfield.html">Flat-field correction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fluorescent feature localization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-sdt.loc.daostorm_3d">daostorm_3d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-sdt.loc.cg">cg</a></li>
<li class="toctree-l2"><a class="reference internal" href="#z-position-fitting">z position fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-0">Raw pixel extraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nbui.html">GUIs for the Jupyter notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="sim.html">Simulation of microscopy-related data</a></li>
<li class="toctree-l1"><a class="reference internal" href="funcs.html">Special functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot.html">Plotting utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimize.html">Optimization and fitting algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="helper.html">Helpers for writing new code</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Change log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">sdt-python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Fluorescent feature localization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="module-sdt.loc"></span><section id="fluorescent-feature-localization">
<h1>Fluorescent feature localization<a class="headerlink" href="#fluorescent-feature-localization" title="Permalink to this heading">¶</a></h1>
<p>Various algorithms exist for locating fluorescent features with subpixel
accuracy. This package includes the following:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#module-sdt.loc.daostorm_3d" title="sdt.loc.daostorm_3d"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdt.loc.daostorm_3d</span></code></a>: An implementation of 3D-DAOSTORM <a class="reference internal" href="#babc2012" id="id1"><span>[Babc2012]</span></a>,
which is a fast Gaussian fitting algorithm based on maximum likelyhood
estimation, which does several rounds of feature finding and fitting in
order to fit even features which are close together.</p></li>
<li><p><a class="reference internal" href="#module-sdt.loc.cg" title="sdt.loc.cg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdt.loc.cg</span></code></a>: An implementation of the feature localization algorithm
created by Crocker and Grier <a class="reference internal" href="#croc1996" id="id2"><span>[Croc1996]</span></a>, based on the implementation by
the <a class="reference external" href="http://people.umass.edu/kilfoil/tools.php">Kilfoil group</a>.</p></li>
</ul>
<p>All share a similar API modeled after
<a class="reference external" href="https://github.com/soft-matter/trackpy">trackpy</a>’s. For each algorithm
there is a  <code class="docutils literal notranslate"><span class="pre">locate</span></code> function for locating features in a single image,
a <code class="docutils literal notranslate"><span class="pre">batch</span></code> function for locating all features in a series of images,
and <code class="docutils literal notranslate"><span class="pre">locate_roi</span></code> and <code class="docutils literal notranslate"><span class="pre">batch_roi</span></code> functions which only locate features in a
given <code class="xref py py-class docutils literal notranslate"><span class="pre">roi.PathROI</span></code>.</p>
<p>A GUI for feature localization can be started by running <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span>
<span class="pre">sdt.gui.locator</span></code> on a terminal.</p>
<p>Additionally, one can fit the z position from astigmatism (if a zylindrical
lense is inserted into the emission path) with help of the
<a class="reference internal" href="#module-sdt.loc.z_fit" title="sdt.loc.z_fit"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdt.loc.z_fit</span></code></a> module.</p>
<p>The <a class="reference internal" href="#sdt.loc.get_raw_features" title="sdt.loc.get_raw_features"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_raw_features()</span></code></a> function allows for extracting the pixels
around a localized features from an image sequence</p>
<p class="rubric">Examples</p>
<p>Simulate a single molecule image with two features:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">sdt</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">simulate_gauss</span><span class="p">([</span><span class="mi">120</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">70</span><span class="p">]],</span>
<span class="go">                                 [1000, 2000], [[1.1], [1.3]]) + 10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img_seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">img</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># image sequence</span>
</pre></div>
</div>
<p>Localize features in the image using 3D-DAOSTORM:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daostorm_3d</span><span class="o">.</span><span class="n">locate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="go">      x     y  signal   bg          mass  size</span>
<span class="go">0  80.0  70.0  2000.0  9.0  21237.166338   1.3</span>
<span class="go">1  30.0  20.0  1000.0  9.0   7602.654222   1.1</span>
</pre></div>
</div>
<p>Localize features in the whole sequence using 3D-DAOSTORM:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daostorm_3d</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">img_seq</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="go">      x     y  signal   bg          mass  size  frame</span>
<span class="go">0  80.0  70.0  2000.0  9.0  21237.166338   1.3      0</span>
<span class="go">1  30.0  20.0  1000.0  9.0   7602.654222   1.1      0</span>
<span class="go">2  80.0  70.0  2000.0  9.0  21237.166338   1.3      1</span>
<span class="go">3  30.0  20.0  1000.0  9.0   7602.654222   1.1      1</span>
</pre></div>
</div>
<p>The same with the Crocker &amp; Grier algorithm:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cg</span><span class="o">.</span><span class="n">locate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="go">      x     y          mass      size           ecc</span>
<span class="go">0  30.0  20.0   7629.111685  1.501792  2.563823e-16</span>
<span class="go">1  80.0  70.0  18272.005359  1.549778  5.062440e-16</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cg</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">img_seq</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="go">      x     y          mass      size           ecc  frame</span>
<span class="go">0  30.0  20.0   7629.111685  1.501792  2.563823e-16      0</span>
<span class="go">1  80.0  70.0  18272.005359  1.549778  5.062440e-16      0</span>
<span class="go">2  30.0  20.0   7629.111685  1.501792  2.563823e-16      1</span>
<span class="go">3  80.0  70.0  18272.005359  1.549778  5.062440e-16      1</span>
</pre></div>
</div>
<p>To restrict feature localization to a sub-region of the image, use the
<code class="docutils literal notranslate"><span class="pre">locate_roi</span></code> and <code class="docutils literal notranslate"><span class="pre">batch_roi</span></code> functions. Note that coordinates are now
relative to the bounding box of the ROI.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]]</span>  <span class="c1"># Diamond containing one feat</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daostorm_3d</span><span class="o">.</span><span class="n">locate_roi</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="go">      x     y  signal   bg         mass  size</span>
<span class="go">0  20.0  10.0  1000.0  9.0  7602.654223   1.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daostorm_3d</span><span class="o">.</span><span class="n">batch_roi</span><span class="p">(</span><span class="n">img_seq</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="go">      x     y  signal   bg         mass  size  frame</span>
<span class="go">0  20.0  10.0  1000.0  9.0  7602.654223   1.1      0</span>
<span class="go">1  20.0  10.0  1000.0  9.0  7602.654223   1.1      1</span>
</pre></div>
</div>
<section id="module-sdt.loc.daostorm_3d">
<span id="daostorm-3d"></span><h2>daostorm_3d<a class="headerlink" href="#module-sdt.loc.daostorm_3d" title="Permalink to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.daostorm_3d.locate">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.daostorm_3d.</span></span><span class="sig-name descname"><span class="pre">locate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_params=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">find_filter=&lt;sdt.loc.snr_filters.Identity</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">find_filter_opts={}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_distance=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size_range=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">engine='numba'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations=20</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/daostorm_3d/api.html#locate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.daostorm_3d.locate" title="Permalink to this definition">¶</a></dt>
<dd><p>Locate bright, Gaussian-like features in an image</p>
<p>Uses the 3D-DAOSTORM algorithm <a class="reference internal" href="#babc2012" id="id3"><span>[Babc2012]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_image</strong> (<em>array-like</em>) – Raw image data</p></li>
<li><p><strong>radius</strong> (<em>float</em>) – This is in units of pixels. Initial guess for the radius of the
features.</p></li>
<li><p><strong>model</strong> (<em>{&quot;2dfixed&quot;</em><em>, </em><em>&quot;2d&quot;</em><em>, </em><em>&quot;3d&quot;</em><em>, </em><em>&quot;z&quot;}</em>) – “2dfixed” will do fixed sigma 2d Gaussian fitting. “2d” does variable
sigma 2d Gaussian fitting. “3d” means that x, y sigma are independently
variables (elliptical Gaussian, this is intened for determining the
z position from astigmatism). When using “z”, the z position is
varied to fit the signal x and y sigmas.</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – A number roughly equal to the value of the brightest pixel (minus the
CCD baseline) in the dimmest peak to be detected. Local maxima with
brightest pixels below this threshold will be discarded.</p></li>
<li><p><strong>z_params</strong> (<a class="reference internal" href="#sdt.loc.z_fit.Parameters" title="sdt.loc.z_fit.Parameters"><em>z_fit.Parameters</em></a><em> or </em><em>str</em><em> or </em><em>pandas.DataFrame</em><em> or </em><em>None</em>) – Only necessary if the <cite>model</cite> is “z” (then it cannot be <cite>None</cite>),
otherwise it is ignored. One may pass a <code class="xref py py-class docutils literal notranslate"><span class="pre">z_fit.Parameters</span></code>
instance or a filename to load the parameters from or a
<code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with calibration data (<cite>z</cite> vs. <cite>size_x</cite>
and <cite>size_y</cite>).</p></li>
<li><p><strong>find_filter</strong> (str or <code class="xref py py-class docutils literal notranslate"><span class="pre">snr_filters.SnrFilter</span></code>, optional) – Apply a filter to the raw image data for the feature finding step.
Fitting is still done on the original image. <cite>find_filter</cite> can be the
name of one of the filters in <code class="xref py py-mod docutils literal notranslate"><span class="pre">snr_filters</span></code> (i. e. “Identity”,
“Cg”, or “Gaussian”) or an <code class="xref py py-class docutils literal notranslate"><span class="pre">snr_filters.SnrFilter</span></code> instance.
“Identity” is the identity transform, i. e. does nothing. “Cg” is
the Crocker &amp; Grier bandpass filter, see
<code class="xref py py-func docutils literal notranslate"><span class="pre">sdt.image.filters.cg()</span></code>, and “Gaussian” is a Gaussian filter.
Defaults to “Identity”.</p></li>
<li><p><strong>find_filter_opts</strong> (<em>dict</em>) – Parameters to be passed to the filter. For “Cg”, this is
“feature_radius”, for “Gaussian”, this is “sigma”</p></li>
<li><p><strong>min_distance</strong> (<em>float</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – Minimum distance between two features. This can be used to suppress
detection of bright features as multiple overlapping ones if
<cite>threshold</cite> is rather low. If <cite>None</cite>, use <cite>radius</cite> (original
3D-DAOSTORM behavior). Defaults to None.</p></li>
<li><p><strong>size_range</strong> (<em>list of float</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – [min, max] of the feature sizes both in x and y direction. Features
with sizes not in the range will be discarded, neighboring features
will be re-fit. If None, use <code class="docutils literal notranslate"><span class="pre">[0.25*radius,</span> <span class="pre">inf]</span></code> (original
3D-DAOSTORM behavior). Defaults to None.</p></li>
<li><p><strong>engine</strong> (<em>{&quot;python&quot;</em><em>, </em><em>&quot;numba&quot;}</em><em>, </em><em>optional</em>) – Which engine to use for calculations. “numba” is much faster than
“python”, but requires numba to be installed. Defaults to “numba”</p></li>
<li><p><strong>max_iterations</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of iterations for successive peak finding and fitting.
Default: 20</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>x and y are the coordinates of the features. mass is the total
intensity of the feature, bg the background per pixel. size gives the
radii (sigma) of the features. If <cite>raw_image</cite> has a <cite>frame_no</cite>
attribute, a <cite>frame</cite> column with this information will also be
appended.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>DataFrame([x, y, z, signal, mass, bg, size])</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.daostorm_3d.locate_roi">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.daostorm_3d.</span></span><span class="sig-name descname"><span class="pre">locate_roi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sdt.loc.daostorm_3d.locate_roi" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a ROI in an image or image sequence using <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p>
<p>This chooses a region of interest in an image (or image sequence)
before calling <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>image data</em>) – Passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> as the first argument.</p></li>
<li><p><strong>roi</strong> (<a class="reference internal" href="roi.html#sdt.roi.PathROI" title="sdt.roi.PathROI"><em>roi.PathROI</em></a><em> or </em><em>path</em>) – If this isn’t already a py:class:<cite>PathROI</cite>, use it to construct
one, i. e. it is passed as the first parameter to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">PathROI</span></code> constructor.</p></li>
<li><p><strong>rel_origin</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the top-left corner coordinates of the path’s bounding
rectangle will be subtracted off all feature coordinates, i. e.
the top-left corner will be the new origin. Defaults to True.
This is a keyword-only argument.</p></li>
<li><p><strong>*args</strong> – Positional arguments passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Result of the calls to <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> restricted to the ROI.
Coordinates are given with respect to the bounding box of the ROI.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.daostorm_3d.batch">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.daostorm_3d.</span></span><span class="sig-name descname"><span class="pre">batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frames</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sdt.loc.daostorm_3d.batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Process an image stack using <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p>
<p>Apply <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> to each image in <code class="docutils literal notranslate"><span class="pre">frames</span></code>. The image is
passed as the first argument. For details on function parameters, see
the <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> documentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>frames</strong> (<em>iterable of images</em>) – Iterable of array-like objects that represent image data</p></li>
<li><p><strong>*args</strong> – Positional arguments passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
<li><p><strong>num_threads</strong> (<em>int</em>) – Number of CPU threads to use. Defaults to the number of CPUs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Concatenation of DataFrames returned by the individual
<a class="reference internal" href="#sdt.loc.daostorm_3d.locate" title="sdt.loc.daostorm_3d.locate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">locate()</span></code></a> calls. Additionally, there is a “frame”
column specifying the frame number.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.daostorm_3d.batch_roi">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.daostorm_3d.</span></span><span class="sig-name descname"><span class="pre">batch_roi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sdt.loc.daostorm_3d.batch_roi" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a ROI in an image or image sequence using <a class="reference internal" href="#sdt.loc.daostorm_3d.batch" title="sdt.loc.daostorm_3d.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a></p>
<p>This chooses a region of interest in an image (or image sequence)
before calling <a class="reference internal" href="#sdt.loc.daostorm_3d.batch" title="sdt.loc.daostorm_3d.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>image data</em>) – Passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.batch" title="sdt.loc.daostorm_3d.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a> as the first argument.</p></li>
<li><p><strong>roi</strong> (<a class="reference internal" href="roi.html#sdt.roi.PathROI" title="sdt.roi.PathROI"><em>roi.PathROI</em></a><em> or </em><em>path</em>) – If this isn’t already a py:class:<cite>PathROI</cite>, use it to construct
one, i. e. it is passed as the first parameter to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">PathROI</span></code> constructor.</p></li>
<li><p><strong>rel_origin</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the top-left corner coordinates of the path’s bounding
rectangle will be subtracted off all feature coordinates, i. e.
the top-left corner will be the new origin. Defaults to True.
This is a keyword-only argument.</p></li>
<li><p><strong>*args</strong> – Positional arguments passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.batch" title="sdt.loc.daostorm_3d.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a></p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#sdt.loc.daostorm_3d.batch" title="sdt.loc.daostorm_3d.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Result of the calls to <a class="reference internal" href="#sdt.loc.daostorm_3d.batch" title="sdt.loc.daostorm_3d.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a> restricted to the ROI.
Coordinates are given with respect to the bounding box of the ROI.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-sdt.loc.cg">
<span id="cg"></span><h2>cg<a class="headerlink" href="#module-sdt.loc.cg" title="Permalink to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.cg.locate">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.cg.</span></span><span class="sig-name descname"><span class="pre">locate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_thresh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mass_thresh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bandpass</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_radius</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/cg/api.html#locate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.cg.locate" title="Permalink to this definition">¶</a></dt>
<dd><p>Locate bright, Gaussian-like features in an image</p>
<p>This implements an algorithm proposed by Crocker &amp; Grier <a class="reference internal" href="#croc1996" id="id4"><span>[Croc1996]</span></a>
and is based on the implementation by the Kilfoil group, see
<a class="reference external" href="http://people.umass.edu/kilfoil/tools.php">http://people.umass.edu/kilfoil/tools.php</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_image</strong> (<em>array-like</em>) – Raw image data</p></li>
<li><p><strong>radius</strong> (<em>int</em>) – This should be a number a little greater than the radius of the
peaks.</p></li>
<li><p><strong>signal_thresh</strong> (<em>float</em>) – A number roughly equal to the value of the brightest pixel (minus the
CCD baseline) in the dimmest peak to be detected. Local maxima with
brightest pixels below this threshold will be discarded.</p></li>
<li><p><strong>mass_thresh</strong> (<em>float</em>) – Use a number roughly equal to the integrated intensity (mass) of the
dimmest peak (minus the CCD baseline) that should be detected. If this
is too low more background will be detected. If it is too high more
peaks will be missed.</p></li>
<li><p><strong>bandpass</strong> (<em>bool</em><em>, </em><em>optional</em>) – Set to True to turn on bandpass filtering, false otherwise. Default is
True.</p></li>
<li><p><strong>noise_radius</strong> (<em>float</em><em>, </em><em>optional</em>) – Noise correlation length in pixels. Defaults to 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>x and y are the coordinates of the features. mass is the total
intensity of the feature. size gives the radii of gyration of the
features and ecc the eccentricity. If <code class="docutils literal notranslate"><span class="pre">raw_image</span></code> has a <cite>frame_no</cite>
attribute, a <code class="docutils literal notranslate"><span class="pre">frame</span></code> column with this information will also be
appended.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>DataFrame([“x”, “y”, “mass”, “size”, “ecc”])</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.cg.locate_roi">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.cg.</span></span><span class="sig-name descname"><span class="pre">locate_roi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sdt.loc.cg.locate_roi" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a ROI in an image or image sequence using <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p>
<p>This chooses a region of interest in an image (or image sequence)
before calling <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>image data</em>) – Passed to <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> as the first argument.</p></li>
<li><p><strong>roi</strong> (<em>path</em>) – This is used by the <a class="reference internal" href="roi.html#sdt.roi.PathROI" title="sdt.roi.PathROI"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdt.roi.PathROI</span></code></a> constructor
to create the ROI</p></li>
<li><p><strong>rel_origin</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the top-left corner coordinates of the path’s bounding
rectangle will be subtracted off all feature coordinates, i. e.
the top-left corner will be the new origin. Defaults to True.
This is a keyword-only argument.</p></li>
<li><p><strong>*args</strong> – Positional arguments passed to <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Result of the calls to <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> restricted to the ROI.
Coordinates are given with respect to the bounding box of the ROI.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.cg.batch">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.cg.</span></span><span class="sig-name descname"><span class="pre">batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frames</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sdt.loc.cg.batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Process an image stack using <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p>
<p>Apply <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> to each image in <code class="docutils literal notranslate"><span class="pre">frames</span></code>. The image is
passed as the first argument. For details on function parameters, see
the <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> documentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>frames</strong> (<em>iterable of images</em>) – Iterable of array-like objects that represent image data</p></li>
<li><p><strong>*args</strong> – Positional arguments passed to <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Concatenation of DataFrames returned by the individual
<a class="reference internal" href="#sdt.loc.cg.locate" title="sdt.loc.cg.locate"><code class="xref py py-func docutils literal notranslate"><span class="pre">locate()</span></code></a> calls. Additionally, there is a “frame”
column specifying the frame number.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.cg.batch_roi">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.cg.</span></span><span class="sig-name descname"><span class="pre">batch_roi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sdt.loc.cg.batch_roi" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a ROI in an image or image sequence using <a class="reference internal" href="#sdt.loc.cg.batch" title="sdt.loc.cg.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a></p>
<p>This chooses a region of interest in an image (or image sequence)
before calling <a class="reference internal" href="#sdt.loc.cg.batch" title="sdt.loc.cg.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>image data</em>) – Passed to <a class="reference internal" href="#sdt.loc.cg.batch" title="sdt.loc.cg.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a> as the first argument.</p></li>
<li><p><strong>roi</strong> (<em>path</em>) – This is used by the <a class="reference internal" href="roi.html#sdt.roi.PathROI" title="sdt.roi.PathROI"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdt.roi.PathROI</span></code></a> constructor
to create the ROI</p></li>
<li><p><strong>rel_origin</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the top-left corner coordinates of the path’s bounding
rectangle will be subtracted off all feature coordinates, i. e.
the top-left corner will be the new origin. Defaults to True.
This is a keyword-only argument.</p></li>
<li><p><strong>*args</strong> – Positional arguments passed to <a class="reference internal" href="#sdt.loc.cg.batch" title="sdt.loc.cg.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a></p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#sdt.loc.cg.batch" title="sdt.loc.cg.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Result of the calls to <a class="reference internal" href="#sdt.loc.cg.batch" title="sdt.loc.cg.batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">batch()</span></code></a> restricted to the ROI.
Coordinates are given with respect to the bounding box of the ROI.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="z-position-fitting">
<h2>z position fitting<a class="headerlink" href="#z-position-fitting" title="Permalink to this heading">¶</a></h2>
<p>By introducing a zylindrical lense into the emission pathway, the point spread
function gets distorted depending on the z position of the emitter. Instead of
being circular, it becomes elliptic. This can used to deteremine the z
position of the emitter, provided the feature fitting algorithm supports
fitting elliptical features. Currently, this is true only for
<a class="reference internal" href="#module-sdt.loc.daostorm_3d" title="sdt.loc.daostorm_3d"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdt.loc.daostorm_3d</span></code></a>.</p>
<span class="target" id="module-sdt.loc.z_fit"></span><dl class="py class">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Fitter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sdt.loc.z_fit.</span></span><span class="sig-name descname"><span class="pre">Fitter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Fitter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Fitter" title="Permalink to this definition">¶</a></dt>
<dd><p>Class for fitting the z position from the elipticity of PSFs</p>
<p>This implements the Zhuang group’s z fitting algorithm <a class="footnote-reference brackets" href="#id6" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>*<span class="fn-bracket">]</span></a>. The
calibration curves for x and y are calculated from the parameters and the
z position is determined by finding the minimum “distance” from the curve.</p>
<aside class="footnote brackets" id="id6" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">*</a><span class="fn-bracket">]</span></span>
<p>See the <cite>fitz</cite> program in the <cite>sa_utilities</cite> directory in
<a class="reference external" href="https://github.com/ZhuangLab/storm-analysis">their git repository</a>.</p>
</aside>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> (<a class="reference internal" href="#sdt.loc.z_fit.Parameters" title="sdt.loc.z_fit.Parameters"><em>Parameters</em></a>) – Z fit parameters</p></li>
<li><p><strong>resolution</strong> (<em>float</em><em>, </em><em>optional</em>) – Resolution, i. e. smallest z change detectable. Defaults to 1e-3.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Fitter.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Fitter.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Fitter.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the z position</p>
<p>Takes a <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with <cite>size_x</cite> and <cite>size_y</cite>
columns and writes the <cite>z</cite> column.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>pandas.DataFrame</em>) – Fitting data. There need to be <cite>size_x</cite> and <cite>size_y</cite> columns.
A <cite>z</cite> column will be written with fitted <cite>z</cite> position values.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sdt.loc.z_fit.</span></span><span class="sig-name descname"><span class="pre">Parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">z_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(-</span> <span class="pre">0.5,</span> <span class="pre">0.5)</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Z position fitting parameters</p>
<p>When imaging with a zylindrical lense in the emission path, round features
are deformed into ellipses whose semiaxes extensions are computed as</p>
<div class="math notranslate nohighlight">
\[w = w_0 \sqrt{1 + \left(\frac{z - c}{d}\right)^2 +
a_1 \left(\frac{z - c}{d}\right)^3 +
a_2 \left(\frac{z - c}{d}\right)^4 + \ldots}\]</div>
<dl class="py class">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.Tuple">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Tuple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">w0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters.Tuple"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters.Tuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Named tuple of the parameters for one axis</p>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">w0,</span> <span class="pre">c,</span> <span class="pre">d</span></span></dt>
<dd><p><span class="math notranslate nohighlight">\(w_0, c, d\)</span> of the calibration curve</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.Tuple.a">
<span class="sig-name descname"><span class="pre">a</span></span><a class="headerlink" href="#sdt.loc.z_fit.Parameters.Tuple.a" title="Permalink to this definition">¶</a></dt>
<dd><p>Polynomial coefficients <span class="math notranslate nohighlight">\(a_i\)</span> of the calibration curve</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.z_range">
<span class="sig-name descname"><span class="pre">z_range</span></span><a class="headerlink" href="#sdt.loc.z_fit.Parameters.z_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Minimum and maximum valid z positions. Defaults to (-0.5, 0.5).</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.x">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">x</span></span><a class="headerlink" href="#sdt.loc.z_fit.Parameters.x" title="Permalink to this definition">¶</a></dt>
<dd><p>x calibration curve parameter <a class="reference internal" href="#sdt.loc.z_fit.Parameters.Tuple" title="sdt.loc.z_fit.Parameters.Tuple"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code></a></p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.y">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">y</span></span><a class="headerlink" href="#sdt.loc.z_fit.Parameters.y" title="Permalink to this definition">¶</a></dt>
<dd><p>y calibration curve parameter <a class="reference internal" href="#sdt.loc.z_fit.Parameters.Tuple" title="sdt.loc.z_fit.Parameters.Tuple"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.sigma_from_z">
<span class="sig-name descname"><span class="pre">sigma_from_z</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">z</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters.sigma_from_z"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters.sigma_from_z" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate x and y sigmas corresponding to a z position</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>z</strong> (<em>numpy.ndarray</em>) – Array of z positions</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>First row contains sigmas in x direction, second row is for the
y direction.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray, shape=(2, len(z))</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.exp_factor_from_z">
<span class="sig-name descname"><span class="pre">exp_factor_from_z</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">z</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters.exp_factor_from_z"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters.exp_factor_from_z" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the factor in the exponential of the Gaussian</p>
<p>Calculate the factors <span class="math notranslate nohighlight">\(s_x, s_y\)</span> in <span class="math notranslate nohighlight">\(A \exp(-s_x(x-x_c)^2)
\exp(-s_y(y-y_c)^2)\)</span>. These factors are therefore
<span class="math notranslate nohighlight">\(\frac{1}{2\sigma^2}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>z</strong> (<em>numpy.ndarray</em>) – Array of z positions</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>First row contains s in x direction, second row is for the
y direction.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray, shape=(2, len(z))</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.exp_factor_der">
<span class="sig-name descname"><span class="pre">exp_factor_der</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters.exp_factor_der"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters.exp_factor_der" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the derivative of the the exponential factor w.r.t. z</p>
<p>The analytical expression for this is</p>
<div class="math notranslate nohighlight">
\[\frac{ds}{dz} = -\frac{2 w_0^2 s^2}{d}
\left(2\frac{z - c}{d} + 3 a_1 \left(\frac{z - c}{d}\right)^2 +
4 a_2 \left(\frac{z - c}{d}\right)^3 + \ldots \right).\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>z</strong> (<em>numpy.ndarray</em>) – Array of z positions</p></li>
<li><p><strong>factor</strong> (<em>numpy.ndarray</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – Result of <a class="reference internal" href="#sdt.loc.z_fit.Parameters.exp_factor_from_z" title="sdt.loc.z_fit.Parameters.exp_factor_from_z"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exp_factor_from_z()</span></code></a> call. If <cite>None</cite>, it
will be called in this method. The purpose of this is to speed
up computation if the exponential factor has already been
calculated.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>First row contains <span class="math notranslate nohighlight">\(\frac{ds}{dz}\)</span> in x direction, second
row is for the y direction.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray, shape=(2, len(z))</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save parameters to a yaml file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file</strong> (<em>str</em><em> or </em><em>file-like object</em>) – File name or file to write to</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.load">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load parameters from a yaml file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file</strong> (<em>str</em><em> or </em><em>file-like object</em>) – File name or file to read from</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Class instance with parameters loaded from file</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#sdt.loc.z_fit.Parameters" title="sdt.loc.z_fit.Parameters">Parameters</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sdt.loc.z_fit.Parameters.calibrate">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calibrate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">Tuple(w0=1.0,</span> <span class="pre">c=0.0,</span> <span class="pre">d=1.0,</span> <span class="pre">a=array([1.,</span> <span class="pre">1.]))</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(-</span> <span class="pre">0.5,</span> <span class="pre">0.5)</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/z_fit.html#Parameters.calibrate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.z_fit.Parameters.calibrate" title="Permalink to this definition">¶</a></dt>
<dd><p>Get parameters from calibration sample</p>
<p>Extract fitting parameters from PSFs where the z position is known.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loc</strong> (<em>pandas.DataFrame</em>) – Localization data of a calibration sample. <cite>z</cite>, <cite>size_x</cite>, and
<cite>size_y</cite> columns need to be present.</p></li>
<li><p><strong>guess</strong> (<em>ParamTuple</em><em>, </em><em>optional</em>) – Initial guess for the parameter fitting. The length of the
<cite>guess.a</cite> array also determines the number of polynomial parameters
to be fitted. Defaults to (1., 0., 1., np.ones(2)).</p></li>
<li><p><strong>z_range</strong> (<em>tuple of float</em>) – Minimum and maximum valid z positions. Defaults to (-0.5, 0.5).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Class instance with parameters from the calibration sample</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#sdt.loc.z_fit.Parameters" title="sdt.loc.z_fit.Parameters">Parameters</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-0">
<span id="raw-pixel-extraction"></span><h2>Raw pixel extraction<a class="headerlink" href="#module-0" title="Permalink to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sdt.loc.get_raw_features">
<span class="sig-prename descclassname"><span class="pre">sdt.loc.</span></span><span class="sig-name descname"><span class="pre">get_raw_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loc_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/sdt/loc/raw_features.html#get_raw_features"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sdt.loc.get_raw_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Get raw image data surrounding localizations</p>
<p>For each localization, return the raw image data in the proximity
to the feature position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loc_data</strong> (<em>pandas.DataFrame</em>) – Localization data. Index should be unique.</p></li>
<li><p><strong>img_data</strong> (<em>list-like of numpy.ndarray</em>) – Image sequence</p></li>
<li><p><strong>size</strong> (<em>int</em>) – For each feature, return a square of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">size</span> <span class="pre">+</span> <span class="pre">1</span></code> pixels.</p></li>
<li><p><strong>columns</strong> (<em>dict</em><em>, </em><em>optional</em>) – Override default column names as defined in <code class="xref py py-attr docutils literal notranslate"><span class="pre">config.columns</span></code>.
Relevant names are <cite>coords</cite> and <cite>time</cite>.
This means, if your DataFrame has coordinate columns “x” and “z” and
the time column “alt_frame”, set <code class="docutils literal notranslate"><span class="pre">columns={&quot;coords&quot;:</span> <span class="pre">[&quot;x&quot;,</span> <span class="pre">&quot;z&quot;],</span>
<span class="pre">&quot;time&quot;:</span> <span class="pre">&quot;alt_frame&quot;}</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Image data for features. Uses the localization data indices as keys
(therefore, the index of <cite>loc_data</cite> has to be unique) and square
<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarrays</span></code> of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">size</span> <span class="pre">+</span> <span class="pre">1</span></code> pixels as values.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>OrderedDict</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">References</p>
<div role="list" class="citation-list">
<div class="citation" id="babc2012" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Babc2012<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id3">2</a>)</span>
<p>Babcock et al.: “A high-density 3D localization algorithm for
stochastic optical reconstruction microscopy”, Opt Nanoscopy, 2012, 1</p>
</div>
<div class="citation" id="croc1996" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Croc1996<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id4">2</a>)</span>
<p>Crocker, J. C. &amp; Grier, D. G.: “Methods of digital video
microscopy for colloidal studies”, Journal of colloid and interface
science, Elsevier, 1996, 179, 298-310</p>
</div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="nbui.html" class="btn btn-neutral float-right" title="GUIs for the Jupyter notebook" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="flatfield.html" class="btn btn-neutral float-left" title="Flat-field correction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015—2022, Lukas Schrangl.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>